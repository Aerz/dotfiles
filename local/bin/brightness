#!/usr/bin/env bash

list_ddcci_paths() {
    light -L | grep "sysfs/backlight/ddcci*" | sed 's/\s//g'
}

case $1 in
    -u|--up)
        list_ddcci_paths | xargs -I{} light -s {} -A 5 &
    ;;
    -d|--down)
        list_ddcci_paths | xargs -I{} light -s {} -U 5 &
    ;;
    -r|--restart)
        notify-send -t 10000 -u low ' Brightness' 'Restarting service...'
        systemctl restart ddcci-backlight
        notify-send -t 10000 -u normal \
            ' Brightness' \
            "Service restarted, displays loaded:\n$(list_ddcci_paths | cut -d '/' -f 3)"

        # restart polybar if it's running
        [[ $(pgrep -x polybar) ]] && polybar-msg cmd restart
    ;;
    [0-9]*)
        list_ddcci_paths | xargs -I{} light -s {} -S $1
    ;;
    *)
        notify-send -u normal \
            ' Brightness' \
            "Displays loaded:\n$(list_ddcci_paths | cut -d '/' -f 3)"
    ;;
esac
